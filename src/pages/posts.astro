---
import Layout from '@layouts/Layout.astro';
import PostCard from '@components/post/PostCard.astro';
import Pagination from '@components/common/Pagination.astro';
import { getTotalPages } from '@utils/pageUtils';
import { CollectionUtils, PostUtils } from "@utils/collectionUtils";
import { siteConfig } from "@config";

const { content: contentConfig } = siteConfig;
const postsPerPage = contentConfig.postsPerPage;

// Get all blog posts and sort by date
const sortedPosts = await new CollectionUtils("posts")
  .filter(PostUtils.filterNotDraft)
  .sortBy(PostUtils.compareByDateDesc)
  .all();

// Get pagination data for first page
const totalPages = getTotalPages(sortedPosts.length, postsPerPage);
const paginatedPosts = sortedPosts.slice(0, postsPerPage);
---

<Layout
  title={`文章`}
  description="技术文章和学习笔记"
>
  <main class="w-full py-8">
    <header class="mb-10">
      <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4">文章</h1>
      <p class="text-lg text-gray-700 dark:text-gray-300">
        技术文章、学习笔记
      </p>
    </header>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {paginatedPosts.map((post) => (
        <PostCard post={post} />
      ))}
    </div>
    {
      sortedPosts.length === 0 && (
        <div class="text-center py-12">
          <p class="text-gray-600 dark:text-gray-400">
            暂无文章
          </p>
        </div>
      )
    }
    <Pagination
      currentPage={1}
      totalPages={totalPages}
      prevUrl={null}
      nextUrl={sortedPosts.length > postsPerPage ? `/posts/page/2` : null}
      basePath="/posts/page"
    />

  </main>
</Layout>
