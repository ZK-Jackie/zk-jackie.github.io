---
import { render, type CollectionEntry } from 'astro:content';
import PostLayout from '@layouts/PostLayout.astro';
import { CollectionUtils, PostUtils } from "@utils/collectionUtils";

// Import all widget components for MDX files
import * as MarkdownComponents from '@layouts/components/MarkdownComponents.astro';


interface Path {
  params: { slug: string };
  props: Props;
}

interface Props {
  post: CollectionEntry<"posts">;
}

// Get all blog posts
export async function getStaticPaths(): Promise<Path[]> {
  const posts: CollectionEntry<"posts">[] = await new CollectionUtils("posts")
    .filter(PostUtils.filterNotDraft)
    .filter(PostUtils.filterNotIdStartsWithSlash)
    .all();

  return PostUtils.getPageDataList(posts).map(
    post => ({
      params: { slug: post.slug },
      props: { post: post.post },
    })
  );
}

const { post } = Astro.props;
// Pass all widget components to MDX content
const { Content, headings, remarkPluginFrontmatter } = await render(post);
---

<PostLayout postSlug={post.id} postData={post.data} postHeadings={headings}>
  <Content components={MarkdownComponents} />
</PostLayout>
